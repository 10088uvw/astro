---
const { default: route, id } = Astro.props;

function getRoutePath(...parts: string[]) {
	return parts.map(part => part.replace(/^\/|\/$/g, '')).join('/');
}

const routes = import.meta.glob('/src/pages/routes/**/*');
const components = new Map();
for (let [key, getComponent] of Object.entries(routes)) {
	key = key.replace(`/src/pages/routes/`, '').split('.').slice(0, -1).join('').replace(/\/index$/, '');
	components.set(key, getComponent)
}

let Child = Fragment;
if (route) {
	const target = getRoutePath(id, route);
	const fn = components.get(target)
	if (fn) {
		Child = fn().then((mod) => mod.default);
	}
}
---

<router-outlet id={id} route={route}><Child /></router-outlet>
